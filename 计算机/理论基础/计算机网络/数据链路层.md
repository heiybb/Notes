一、数据链路层的通俗理解
  以PC为例，
	
二、数据链路信道
	点对点信道
	广播信道
	
三、数据链路和帧
	链路：从一个结点到相邻结点的物理线路——中间不允许有其它结点
	数据链路：
		除了含有链路的定义之外，还包含一些控制数据传输的协议，一般使用网络适配器（就是传说中的网卡）来实现这些功能（实际上实现的包括物理层和数据链路层的功能）
		
	帧：数据链路层的协议（也称规程）数据单元，是最终放在链路上的数据单元
	
四、三个基本问题
	1、封装成帧
		网络层传下来的称为IP数据报——在封装后称为帧的数据部分，封装过程即在IP数据报前面加上帧首部，在后面加上帧尾部，为了让每个帧可识别，一般帧首部第一个字符为SOH(ASCII-0000 0001)，帧尾部最后一个字符为EOH(ASCII-0000 0100)，而接收方就通过这两个字符判断帧范围
	2、透明传输
		当传输文本文件的时候，键盘上不可能输入SOH和EOH两个字符（事实上ASCII码的这两个字符就是为此而设计的），所以不用担心误判；但是当传输不是文本文件的时候，就可能进行误判，所以采用会加上“转义符”——ESC(ASCII-0001 1011)，这种方法称为字符填充或字节填充
	3、差错检测
		对“比特差错”（即1变为0或者0变为1）进行检测的行为叫做差错检测，这个行为的原因是误码率BER（信噪比越高，误码率越低）不可能为0，现在一般采用CRC校验法则进行检测
		
		CRC校验只能做到对帧的无差错接受，且数据链路层向网络层提供的不是“可靠传输”（可靠传输指发送端发送什么，接收端就收到什么）的服务，所以可能会出现帧丢失、帧重复和帧失序的“传输错误”，即只能做到“无比特差错”，不能做到“无传输差错”
		
		OSI标准是把数据链路层做成可靠传输，因此在CRC检错上增加了帧编号、确认和重传机制，但现在通信线路质量奇高，出错概率极小，而OSI的这些操作成本又极高，所以并未被现在所采用，而是在出现差错的时候由上层协议（如运输层的TCP协议）来完成，实践证明这样的通信效率较高
		
五、点对点协议PPP
	以前是以OSI为标准的高级数据链路控制HDLC协议占优，但可靠传输的缺点已经说明，所以被简单的PPP协议取代，PPP协议是用户计算机和ISP进行通信时所用的数据链路层协议，所以可以知道PPP协议是所有网卡供应商的标准参考——前提是你想要支持PPP
	
	PPP应满足的要求
		1、简单：只进行接收帧——CRC检测帧——正确收下帧，错误丢弃帧，然后下一帧
		2、封装成帧
		3、透明性传输
		4、支持多种网络层协议
		5、支持多种类型链路
		6、差错检测
		7、检测连接状态：及时检测链路是否处于正常状态
		8、最大传输单元
		9、网络层地址协商：支持通过协商配置彼此的网络层地址
		10、数据压缩协商：支持协商使用压缩算法
	
	
	PPP不需要的功能
		1、纠错
		2、流量控制
		3、帧序号
		4、多点线路
		5、半双工或单工链路
		
	PPP帧格式：
		帧首部包括5个字节，第一个字节为0x7E，称为标志字段F，和前面说的SOH一样是帧起始定界符（注意：前面说的SOH只是一种形象的表示，具体到实体协议还是各有不同）；第二、三个字节分别为0xFF、0x03，这两个字节的是备用定义字节；第四、五两个字节合起来作为协议信息——表示信息部分到底带有的是什么内容（如为）
		
		帧尾部包括3个字节，前两个字节为FCS——CRC检测的帧检测序列，最后为0x7E——帧结束定界符
		
		字节填充时采用0x7D作为“转义符”，但填充方式变得有些复杂，具体如下
			1、出现0x7E就转变为(0x7D,0x5E)
			2、出现0x7D就转变为(0x7D,0x5D)
			3、出现ASCII码控制符（数值小于0x20），则在该字符前面加上0x7D，并改变该字符编码（具体怎么边会有一张标准表）
			
		零比特填充：
			通过扫描整个信息段（通过硬件——网卡电路或软件实现），凡是有5个连续的1就在后面加上1个0——防止错误辨识定界符（0111 1110）
			
		接收方如何知道是采用的那种填充方式？
			通过链路来决定，PPP协议在SONET/SDH链路上采用同步传输（一连串比特连续传输），而在其它链路采用异步传输（逐个字符传输），同步传输时就采用零比特填充，而异步传输时就采用字节填充
		
六、PPP协议工作方式
	1、PPP链路在为连接到ISP时是处于“链路静止”状态，这时候PC和ISP的路由器是不存在物理层连接的
	2、当用户呼叫路由器的时候（中间一般会有调制解调器），路由器就检测调制解调器发出的载波信号，此时双方就建立了物理层连接——进入“链路建立”状态，同时建立链路层的LCP连接
	3、LCP开始协商一些配置选项，即发送LCP的配置请求帧，协议字段（即前面PPP帧首部第四、五个字节）则为LCP对应代码，信息字段则是一些配置请求和配置信息（包括最大帧长、鉴别协议——有的话、不使用的PPP字段等）
	4、ISP端会给出一些响应，主要包括以下几种
		配置确认帧：所有选项都接受
		配置否认帧：所有选项都理解但是不能接受
		配置拒绝帧：选项有的无法识别或不能接受，需要协商
	5、至此，LCP配置协商结束，进入鉴别状态（该状态只允许传输LCP协议分组、鉴别协议分组、检测链路质量分组），鉴别协议一般有PAP（可重复若干次）和CHAP（安全性更高），如果鉴别成功或者无需鉴别，则进入“网络层协议”状态，失败则进入“链路终止”状态
	6、进入“网络层协议”状态，PPP链路两端的网络控制协议NCP根据网络层的不同协议互相交换网络层特定的网络控制分组，这个可以保证不同的网络层协议都运行在PPP协议上
	7、IPCP
	8、到此，网络层配置完毕，链路进入可进行数据通信的“链路打开”状态，相互可进行分组传送，期间会经常发送回送请求LCP分组和回送回答LCP分组——用来检测链路的状态
	9、当需要断开时，就需要发送终止请求LCP分组，在收到终止确认LCP分组后，PC进入“链路终止”状态（和前面鉴别失败进入的状态一样），期间因为其它原因故障也会进入“链路终止”状态，当调制解调器载波停止后，回到“链路静止”状态
	
	问题：考虑“链路静止”状态和“链路打开”状态的关系
		

七、局域网
	局域网的特点：网络为一个单位所有，且地理范围和站点数目均有限
	
	局域网优点：
		1、具有广播功能
		2、便于系统扩展和逐渐演变
		3、提高系统可靠性、可用性和生存性
		
	局域网的分类——按拓扑结构来分
		星形网：以集线器（慢慢会被交换机取代）和双绞线的广泛应用带来的广泛应用
		环形网：令牌环形网——已退出市场
		总线网：使用CSMA/CD协议的传统以太网（已经演变为星形网）和令牌传递总线网（已经退出市场）
		树形网：总线网变种，主要用于频分复用的宽带局域网
		
	局域网具有广播功能，所以需要多个结点共享信道，这样就必须解决冲突的问题，主要有以下几种方式解决
		1、静态划分信道：
			通过信道复用的技术使结点共享物理链路，但是实际信道是单独的，只要分配到信道就不会起冲突
		2、动态媒体接入控制（也称多点接入）——分以下两种接入方式：
			随机接入：用户结点都可以随机的发送信息，但可能会发生碰撞，此时就需要好的网络协议来解决
			受控接入：发送必须进行控制，代表有集中进行的多点线路探询（或称轮询），现已少用
			
	以太网标准：
		以太网是一种局域网，但是现在由于垄断基本是局域网的代名词，但多年前由于不标准IEEE802委员会被迫将链路层分为两层——逻辑链路 控制LLC和媒体接入控制MAC，但现在由于垄断基本只需要MAC层了
		
	适配器（也称网卡或NIC）：
		适配器包括处理器和存储器（就是个小型的嵌入式设备嘛），主要功能包括以下方面
			1、数据串行传输（适配器到局域网）与数据并行传输的转换（适配器到CPU和存储器）
			2、实现以太网协议
			3、实现PPP协议（这是我猜的，如果成立和以太网协议是什么关系）
			
		工作方式：
			自己处理帧而不经过CPU。收到帧时，错误就丢掉，正确就通过终端通知CPU进行交互，问题是驱动到底在这里起了什么作用
			

八、CSMA/CD协议（基于以太网而言）——载波监听多点接入/碰撞检测缩写
	主要特点
		1、采用无连接的工作方式（不必建立连接就可以直接发送数据），帧不被编号也不需要确认，差错帧直接丢弃，是否重传由高层决定。则以太网提供的服务是不可靠的交付——尽最大努力交付
		2、信号采用曼彻斯特编码，即把一个码元分为两部分，前高后低表示0，前低后高表示1，这样就可以避免同时出现很多1或者0时无法确定码元数，但同时他增加了所占频带宽
		
	协调信息的发送——同一时间只允许一台计算机发送信息
		多点接入：即总线型接入方式
		载波监听：发送前监听别处发来的载波
		碰撞检测：
			边发送边检测，发送过程中如果检测到有多个信号源同时进行发送（检测方式即多个同时发送时由于相互叠加的原因波的变化幅度会很大，超过阀值就判断为碰撞，也可通过载波的大小判断）
			
		由此，一个站点不可能同时进行发送和接收，即只能进行双向交替通信
		
	由于以太网的这种发送不确定性，为了保证在以太网上发生碰撞的几率很小，就必须保证整个以太网的平均通信两远小于以太网的最高通信率
	
	考虑一个以太网模型，只抽象出相距最远的两台（后面会发现只需要这两台）A和B，从A到B传输需要t时间，则发出数据后的2t时间就是检测发出的数据是否会碰撞的最长周期（这期间没检测到，则断定没有碰撞），这个周期被称为争用期
	
	为了避免重传的时候又碰撞，确定以下的随机推迟算法（退避）
		1、确定基本退避时间，就是上面的2t（而以太网规定2t=51.2微秒），对于10Mb/s以太网就是512比特时间
		2、从整数集合[0~2^k-1]中随机取数r，k=Min[重传次数,10]，等待r*2t时间后进行重传
		3、重传16次还不成功，就丢弃帧并向高层报告
		
	显然在10Mb/s以太网中如果出现碰撞就只会在前64字节（也就是退避时间产生的比特量）中，所以规定最短有效帧为64字节，小于64字节的都是无效帧
	
	增加强化碰撞措施，即一旦发生碰撞，除了立即停止发送数据还要继续发送32比特或48比特的人为干扰信号，以太网还规定帧间最小间隔（即发送两次帧的间隔时间）为9.6微秒——为了接收端有时间清除上一帧的缓存
	
	
九、集线器
	使用集线器和双绞线是以太网发展的里程碑，但实际上集线器内部依旧是对以太网的总线实现，只是若把集线器看成是一个结点，则以太网看上去就是星形结构。
	
	集线器工作在物理层，所以结构简单，只负责转发，碰撞都不检测，高级点的加上点故障检测的功能
	
十、以太网信道利用率
	通过参数a=t/T0来反映，T0表示从端到端的发送时间，t和前面一样表示时延（在链路上的时间），则a越大，争用期占用比例越大，碰撞检测的可能性低，浪费在争用期的时间就会很长。因此尽量使a增大，两种方式
		1、限制以太网连线长度
		2、增大以太网帧长
		
十一、MAC层
	mac层有固化在Rom中全球唯一地址MAC-48（通用名EUI-48，其中EUI表示扩展的唯一标识符），这个地址由IEEE的注册管理机构RA管理前24位——分配给厂商，这24位的标准名称为组织唯一标识符OUI（也称公司标识符），IEEE还规定了两个单独位——第一字节最低位I/G位（0表示单个站地址，1表示组地址）和第一字节第2低位G/L位（0表示本地管理，1表示全球管理，但基本上不在以太网中用）
	
	适配器具有过滤功能，所以会选择目的地址是自己的帧，而发往一个站点的帧分以下三种：
		单播帧（一对一）：MAC地址与帧目的地址相同
		广播帧（一对全体）：广播协议下的帧
		多播帧（一对多）：发往多个站点的帧
		
	适配器还有一种特殊工作方式——混杂方式，只要链路上有信息通过，都接下来，实际上这是一种窃听（黑客爱干），但一般用在正途就是用于分析流量的（使用嗅探器工具）
	
	MAC帧格式如下（基于DIX Ethernet V2标准，另一个标准为IEEE802.3）
		6字节目的地址、6字节源地址、2字节类型字段（表示上层使用的协议，IEEE802.3在此处表示长度/类型字段，值大于0x0600时表示类型，小于时表示长度）、上层数据字段（IP数据报等，长度在46=64-6-6-2-4字节到1500字节之间）、帧检测序列FCS（CRC检验）
		
		由于采用曼彻斯特编码，所以不用定界符，当电压不变时说明没传帧（每个帧之间都有最小传输间隔）
		
		由于收到帧的时候适配器并未跟上帧的频率，所以在实际链路上，MAC帧会在头部加上8字节（由适配器物理电路实现），包括前7个字节的10循环码（用来调整适配器和帧频同步）和最后一个帧开始定界符——10101011，而物理链路为SONET/SDH时不需要这8个字节
		
		IEEE802.3规定以下为无效MAC帧——直接丢弃：
			1、帧长非整数字节
			2、FCS检查有错
			3、上层数据字段不在46~1500字节之间
	
十二、扩展以太网
	通过集线器和双绞线以树状形式扩展以太网，会增大以太网范围，但同时会将多个碰撞域合并为一个碰撞域，若n个单独的星形以太网通过集线器合成一个以太网，则整个系统的最大速率就由n*t变为t，其中t表示以太网链路的最大吞吐量
	
	
十三、网桥
	网桥与集线器的核心区别就是网桥增加了过滤功能（所以网桥工作在MAC链路层），网桥会通过转发表（也称转发数据库或路由目录）找到该从哪个端口（就是接口）把数据送出
	
	网桥优点：
		1、过滤通信量，增大吞吐量：和集线器不同，通过网桥合并n个独立的以太网后，仍是n个独立的碰撞域，最大速率依旧是n*t
		2、增大物理范围：增加整个以太网上工作站的数目
		3、提高了可靠性：出故障只影响当前网段
		4、可互连不同物理层、不同MAC子层和不同速率的以太网
		
	网桥缺点：
		1、网桥需要检查转发表的时间，还需要执行CSMA/CD协议的时间，增加了时延
		2、没有流量控制功能，当网络中负荷过重，存储空间会溢出，导致帧丢失
		3、适合小型以太网，广播过多会发生广播风暴
		
	透明网桥（基于标准IEEE802.1D）——即转发表动态生成：
		开始时，各网桥的转发表均为空，转发表只有两列——地址和接口，当网桥接收到一帧，进行以下步骤
		1、自学习过程：如果源地址不在转发表中，则记录下源地址（问题：非本网络地址存不存呢？），其对应接口就是传入接口
		2、转发帧过程：如果目的地址已经在转发表中，就查看其对应接口，如果和传入的接口一样，则丢弃，如果不一样，则从对应接口传出；如果目的地址不在转发表中，就从所有非传入接口传出
		
		透明网桥还会使用生成树算法，为的就是防止出现环路发送帧
		
	源路由网桥：
		通过发现帧进行试探，发送过程中产生的广播分支分别记录自己的路由信息（就是中间的路径），到达目的站后（显然有多条）均带着路由信息返回源站，然后源站选择最佳路由进行传输，这样可以充分利用网络资源，同时确定网络能通过的最大帧长度。相比于透明网桥这显然是不透明的（把所有站点都摸清除了），但在选择最佳路由上优势明显
	
	多接口网桥——交换机：
		理解97面最下面红线的话
		现在以太网交换机都采用存储转发方式进行转发，不多情况下使用直通方式（通过硬件直接一个口到另一个口，速度快，但不查错）
		通过交换机很容易建立虚拟局域网VLAN，即对物理局域网的逻辑化（选择将哪些站点分到同一局域网），这个就需要交换机进行过滤操作，这样可进一步防止广播风暴（也就是防止广播到太多无关站点）
		
	扩展MAC帧（基于IEEE802.3ac标准）：
		即在原MAC帧的源地址段和类型段间加上4字节的VLAN标记段，这4字节前2字节总是0x8100，称为IEEE802.1Q标记类型，接着16位为3位优先字段、1位规范格式指示符CFI、12位VLAN标识符VID，相应最大帧长增加4字节
			
十四、告诉以太网
